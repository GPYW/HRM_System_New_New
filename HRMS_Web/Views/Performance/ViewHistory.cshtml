 @model HRMS_Web.Models.ApplicationUser
@using HRMS_Web.ViewModel;
@using HRMS_Web;
@using Microsoft.AspNetCore.Identity
@using HRMS_Web.Models;

@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View History</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        .nav_link {
            color: #000000 !important;
            font-weight: 500;
            margin-right: 20px;
        }

            .nav_link:hover {
                color: #17a2b8 !important;
            }

        #calendar {
            max-width: 900px;
            max-height: 350px;
            margin: 20px auto;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .fc .fc-button {
            background-color: #212529;
            border: none;
            color: #fff;
            border-radius: 4px;
            padding: 8px 16px;
        }

            .fc .fc-button:hover {
                background-color: #1d2124;
            }

        .fc .fc-daygrid-day {
            border: 1px solid #eee;
            padding: 10px;
        }

        .fc .fc-day-today {
            background-color: #f1f1f1;
        }

        .fc .fc-event {
            background-color: #17a2b8;
            border: none;
            border-radius: 4px;
            padding: 5 px;
            color: #fff;
        }

        .fc-toolbar-title {
            font-size: 1rem !important;
            color: #212529;
            font-weight: 600;
        }

        .fc-prev-button, .fc-next-button {
            font-size: 0.5rem !important;
            padding: 0.52rem 0.4rem !important;
        }

        .fc-today-button {
            padding: 0.15rem 0.5rem !important;
        }

        .fc-col-header-cell-cushion {
            color: #212529;
        }

    </style>
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #fff;">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link nav_link" asp-area="" asp-controller="Performance" asp-action="Index">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav_link" asp-area="" asp-controller="Performance" asp-action="Projects">Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav_link" asp-area="" asp-controller="Performance" asp-action="Tasks">Tasks</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav_link" asp-area="" asp-controller="Performance" asp-action="ViewHistory">View History</a>
                    </li>
                    @if (User.IsInRole(SD.Role_Admin))
                    {
                        <li class="nav-item">
                            <a class="nav-link nav_link" asp-area="" asp-controller="Performance" asp-action="Assign">Assign</a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h5>View History</h5>

        <!-- Filter Options -->
        <div class="filter-section">
            <form>
                <div class="row">
                    <div class="col-md-3">
                        <label for="dateRange">From</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <label for="dateRange">To</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <label for="projectFilter">Project</label>
                        <select id="projectFilter" class="form-control">
                            <option value="all">All Projects</option>
                            <!-- Populate with project options -->
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="statusFilter">Status</label>
                        <select id="statusFilter" class="form-control">
                            <option value="all">All Statuses</option>
                            <option value="completed">Completed</option>
                            <option value="in-progress">In Progress</option>
                            <option value="not-started">Not Started</option>
                        </select>
                    </div>
                    <div class="col-md-1 d-flex align-items-end justify-content-end">
                        <button type="button" class="btn btn-dark" onclick="applyFilters()">Apply</button>
                    </div>
                </div>
            </form>
        </div>
        <hr />
        <div class="logs-section mt-4">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Description</th>
                        <th scope="col">Changed By</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Example row -->
                    <tr>
                        <td>2024-07-01</td>
                        <td><span class="badge bg-info" data-bs-toggle="tooltip" data-bs-placement="top" title="Detailed change description">Updated user profile</span></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span>User Name</span>
                            </div>
                        </td>
                    </tr>
                    <!-- Additional rows -->
                </tbody>
            </table>

            <!-- Ensure you include Bootstrap 5 JavaScript for tooltips -->
            <script>
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
            </script>

        </div><hr />
        <!-- Historical Performance Charts -->
        <div class="chart-container pb-1">
            <h5>Historical Performance</h5>
            <div id="line_chart_div"></div>
            <div id="bar_chart_div"></div>
            <div id="pie_chart_div"></div>
        </div>

        <!-- Comments and Feedback -->
        <div class="comments-section">
            <h5>Comments and Feedback</h5>
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Commenter</th>
                        <th scope="col">Comment</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Example row -->
                    <tr>
                        <td>2024-07-01</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span>John Doe</span>
                            </div>
                        </td>
                        <td>
                            <span data-bs-toggle="tooltip" data-bs-placement="top" title="This is an example comment.">This is an example comment.</span>
                        </td>
                    </tr>
                    <!-- Additional rows -->
                </tbody>
            </table>

            <!-- Ensure you include Bootstrap 5 JavaScript for tooltips -->
            <script>
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl)
                })
            </script>

        </div>

        <!-- Export Options -->
        <div class="export-section mt-4">
            <button class="btn btn-dark">Export as CSV</button>
            <button class="btn btn-dark">Export as PDF</button>
        </div>
        <hr /><br />

        <!-- Completion Timelines -->
        <div class="timeline-section">
            <h5>Completion Timelines</h5>
            <div id="gantt_chart_div"></div>
        </div>
    </div>

    <script type="text/javascript">
        // Load Google Charts
        google.charts.load('current', { 'packages': ['corechart', 'gantt'] });
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            // Example Line Chart
            var lineData = google.visualization.arrayToDataTable([
                ['Month', 'Completed Tasks'],
                ['Jan', 30],
                ['Feb', 50],
                ['Mar', 40],
                ['Apr', 60],
                ['May', 80],
                ['Jun', 70]
            ]);

            var lineOptions = {
                title: 'Task Completion Over Time',
                curveType: 'function',
                legend: { position: 'bottom' }
            };

            var lineChart = new google.visualization.LineChart(document.getElementById('line_chart_div'));
            lineChart.draw(lineData, lineOptions);

            // Example Bar Chart
            var barData = google.visualization.arrayToDataTable([
                ['Month', 'Completed Tasks'],
                ['Jan', 30],
                ['Feb', 50],
                ['Mar', 40],
                ['Apr', 60],
                ['May', 80],
                ['Jun', 70]
            ]);

            var barOptions = {
                title: 'Monthly Task Completion',
                legend: { position: 'none' }
            };

            var barChart = new google.visualization.BarChart(document.getElementById('bar_chart_div'));
            barChart.draw(barData, barOptions);

            // Example Pie Chart
            var pieData = google.visualization.arrayToDataTable([
                ['Status', 'Number of Tasks'],
                ['Completed', 45],
                ['In Progress', 25],
                ['Not Started', 30]
            ]);

            var pieOptions = {
                title: 'Task Status Distribution'
            };

            var pieChart = new google.visualization.PieChart(document.getElementById('pie_chart_div'));
            pieChart.draw(pieData, pieOptions);

            // Example Gantt Chart
            var ganttData = new google.visualization.DataTable();
            ganttData.addColumn('string', 'Task ID');
            ganttData.addColumn('string', 'Task Name');
            ganttData.addColumn('string', 'Resource');
            ganttData.addColumn('date', 'Start Date');
            ganttData.addColumn('date', 'End Date');
            ganttData.addColumn('number', 'Duration');
            ganttData.addColumn('number', 'Percent Complete');
            ganttData.addColumn('string', 'Dependencies');

            ganttData.addRows([
                ['Design', 'Design Phase', null, new Date(2024, 0, 1), new Date(2024, 0, 31), null, 100, null],
                ['Development', 'Development Phase', null, new Date(2024, 1, 1), new Date(2024, 3, 30), null, 60, 'Design'],
                ['Testing', 'Testing Phase', null, new Date(2024, 4, 1), new Date(2024, 4, 31), null, 0, 'Development']
            ]);

            var ganttOptions = {
                height: 300,
                gantt: {
                    criticalPathEnabled: true,
                    criticalPathStyle: {
                        stroke: '#e64a19',
                        strokeWidth: 5
                    },
                    labelStyle: {
                        fontName: 'Arial',
                        fontSize: 12,
                        color: '#1a237e'
                    },
                    palette: [
                        {
                            "color": "#00acc1",
                            "dark": "#007c91",
                            "light": "#33c9dc"
                        },
                        {
                            "color": "#8e24aa",
                            "dark": "#5c007a",
                            "light": "#c158dc"
                        }
                    ]
                }
            };

            var ganttChart = new google.visualization.Gantt(document.getElementById('gantt_chart_div'));
            ganttChart.draw(ganttData, ganttOptions);
        }

        function applyFilters() {
            // Function to apply filters and update charts and logs
            alert('Filters applied');
            // Fetch and display filtered data
        }
    </script>
</body>

</html>
